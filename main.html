<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mening Kalendarim</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: linear-gradient(135deg, #0f0c1e, #1e3c72, #2a5298);
      font-family: 'Segoe UI', Arial, sans-serif;
      color: white;
      padding: 10px;
    }
    .container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      max-width: 1400px;
      margin: 0 auto;
      flex: 1;
    }
    .clock, .calendar {
      background: rgba(0,0,0,0.55);
      padding: 30px;
      border-radius: 25px;
      backdrop-filter: blur(15px);
      box-shadow: 0 15px 50px rgba(0,0,0,0.7);
      text-align: center;
    }
    .time { font-size: 6rem; letter-spacing: 8px; text-shadow: 0 0 30px #00ffff; margin: 15px 0; font-weight: 300; }
    .day { font-size: 2.4rem; color: #7fffd4; margin: 10px 0; }
    .date { font-size: 2.6rem; color: #00ffff; }
    .year { font-size: 2rem; opacity: 0.9; }

    .cal-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    .nav-btn {
      width: 60px;
      height: 60px;
      background: #00bcd4;
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 2rem;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(0,188,212,0.6);
    }
    .nav-btn:hover { background: #00e5ff; color: black; transform: scale(1.1); }
    .current { font-size: 2.6rem; font-weight: bold; color: #00ffff; text-shadow: 0 0 15px #00ffff; min-width: 240px; }

    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th { padding: 12px; color: #00ffff; font-size: 1.4rem; }
    td {
      height: 70px;
      font-size: 1.5rem;
      cursor: pointer;
      position: relative;
      transition: 0.3s;
    }
    td:hover { background: #00ffff33; border-radius: 50%; transform: scale(1.15); }
    .today { background: #00ffff; color: black !important; font-weight: bold; border-radius: 50%; }

    .expense {
      font-size: 0.8rem;
      color: #ffeb3b;
      font-weight: bold;
      position: absolute;
      bottom: 4px;
      left: 50%;
      transform: translateX(-50%);
      max-width: 90%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* KATTALASHTIRILGAN INPUT OYNASI */
    .note-input {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%);
      background: white;
      color: black;
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.9);
      z-index: 10;
      text-align: center;
      width: 92%;
      max-width: 450px; /* Kompyuterda cheklov */
      max-height: 90vh;
      overflow-y: auto;
    }
    .note-header {
      font-size: 1.3rem;
      color: #00bcd4;
      margin-bottom: 15px;
      font-weight: bold;
      line-height: 1.4;
    }
    .note-input input, .note-input textarea {
      width: 100%;
      padding: 15px;
      margin: 12px 0;
      border-radius: 12px;
      border: 1px solid #aaa;
      font-size: 1.4rem;
    }
    .note-input textarea {
      height: 120px; /* Kattaroq matn maydoni */
      resize: vertical;
      text-align: left;
    }
    .note-input button {
      padding: 14px 24px;
      margin: 8px 6px;
      background: #00bcd4;
      border: none;
      border-radius: 12px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      font-size: 1.3rem;
      min-width: 100px;
    }
    .note-input button:hover { background: #008ba3; }

    .summary { margin-top: 25px; padding: 15px; background: rgba(0,188,212,0.2); border-radius: 15px; font-size: 1.6rem; color: #ffeb3b; font-weight: bold; }
    .toggle-btn { margin-top: 30px; padding: 14px 40px; background: linear-gradient(45deg, #00ffff, #0088aa); border: none; border-radius: 50px; font-size: 1.4rem; color: black; font-weight: bold; cursor: pointer; }

    @media (min-width: 768px) {
      .container { grid-template-columns: 1fr 1.4fr; }
      .time { font-size: 8rem; }
      .current { font-size: 3.2rem; }
      .nav-btn { width: 70px; height: 70px; font-size: 2.4rem; }
    }
    @media (min-width: 1024px) {
      .time { font-size: 9rem; }
      td { height: 85px; font-size: 1.7rem; }
    }
    @media (max-width: 480px) {
      .time { font-size: 4.5rem; }
      .current { font-size: 2.2rem; }
      .nav-btn { width: 55px; height: 55px; font-size: 1.8rem; }
      td { height: 60px; font-size: 1.3rem; }
      .note-input {
        padding: 20px;
        border-radius: 15px;
      }
      .note-input input, .note-input textarea {
        padding: 14px;
        font-size: 1.3rem;
      }
      .note-input button {
        padding: 12px 20px;
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="clock">
      <div class="time" id="time">88:88:88</div>
      <div class="day" id="day">Juma</div>
      <div class="date" id="date">11 Dekabr</div>
      <div class="year" id="year">2025 yil</div>
      <button class="toggle-btn" id="toggleBtn">24 soat → 12 soat</button>
    </div>

    <div class="calendar">
      <div class="cal-header">
        <button class="nav-btn" id="prevYear">«</button>
        <button class="nav-btn" id="prevMonth">‹</button>
        <div class="current" id="current">Dekabr 2025</div>
        <button class="nav-btn" id="nextMonth">›</button>
        <button class="nav-btn" id="nextYear">»</button>
      </div>

      <table>
        <thead><tr><th>Du</th><th>Se</th><th>Ch</th><th>Pa</th><th>Ju</th><th>Sh</th><th>Ya</th></tr></thead>
        <tbody id="calendarBody"></tbody>
      </table>

      <div class="summary" id="summary">Kunlik: 0 so'm<br>Oylik: 0 so'm</div>
    </div>
  </div>

  <script>
    const current = document.getElementById('current');
    const prevYear = document.getElementById('prevYear');
    const nextYear = document.getElementById('nextYear');
    const prevMonth = document.getElementById('prevMonth');
    const nextMonth = document.getElementById('nextMonth');
    const calendarBody = document.getElementById('calendarBody');
    const summary = document.getElementById('summary');

    let year = new Date().getFullYear();
    let month = new Date().getMonth();
    const months = ["Yanvar","Fevral","Mart","Aprel","May","Iyun","Iyul","Avgust","Sentabr","Oktabr","Noyabr","Dekabr"];

    function formatDate(d) {
      return `${d.getDate().toString().padStart(2,'0')}.${(d.getMonth()+1).toString().padStart(2,'0')}.${d.getFullYear()}`;
    }

    function formatTime(d) {
      return `${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;
    }

    function updateHeader() {
      current.textContent = `${months[month]} ${year}`;
    }

    function renderCalendar() {
      calendarBody.innerHTML = '';
      updateHeader();

      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const startDay = firstDay === 0 ? 6 : firstDay - 1;

      const today = new Date();
      const isCurrentMonth = year === today.getFullYear() && month === today.getMonth();

      const data = JSON.parse(localStorage.getItem('expenses') || '{}');
      let dailyTotal = 0;
      let monthlyTotal = 0;

      let date = 1;
      for (let i = 0; i < 6; i++) {
        let row = document.createElement('tr');
        for (let j = 0; j < 7; j++) {
          let cell = document.createElement('td');
          if (i === 0 && j < startDay || date > daysInMonth) {
            cell.textContent = '';
          } else {
            cell.textContent = date;
            const key = `${year}-${month+1}-${date}`;
            const item = data[key] || {amount: 0, note: '', timestamp: null};
            const amount = parseFloat(item.amount || 0);

            if (amount > 0 || item.note) {
              let exp = document.createElement('div');
              exp.className = 'expense';
              exp.textContent = amount > 0 ? `${amount.toLocaleString()} so'm${item.note ? ' – ' + item.note : ''}` : item.note;
              cell.appendChild(exp);
              monthlyTotal += amount;
            }

            if (isCurrentMonth && date === today.getDate()) {
              cell.classList.add('today');
              dailyTotal = amount;
            }

            let input = document.createElement('div');
            input.className = 'note-input';
            const cellDateStr = `${date} ${months[month]} ${year}`;
            const savedTime = item.timestamp ? new Date(item.timestamp) : null;
            const timeStr = savedTime ? `${formatDate(savedTime)} ${formatTime(savedTime)}` : 'Yangi';

            input.innerHTML = `
              <div class="note-header">
                Qaysi kun uchun: ${cellDateStr}<br>
                Yozilgan vaqt: ${timeStr}
              </div>
              <input type="number" value="${amount||''}" placeholder="Miqdori (so'm)">
              <textarea placeholder="Nima uchun? (masalan: Ovqat, Yo'l haqi)">${item.note||''}</textarea>
              <div>
                <button onclick="save(this,'${key}')">Saqlash</button>
                <button onclick="del(this,'${key}')">O'chirish</button>
                <button onclick="this.parentElement.parentElement.style.display='none'">Bekor</button>
              </div>
            `;
            cell.appendChild(input);

            cell.onclick = (e) => {
              if (!e.target.tagName.match(/BUTTON|INPUT|TEXTAREA/)) {
                document.querySelectorAll('.note-input').forEach(x => x.style.display = 'none');
                input.style.display = 'block';
                input.querySelector('input').focus(); // Avto fokus
              }
            };

            date++;
          }
          row.appendChild(cell);
        }
        calendarBody.appendChild(row);
        if (date > daysInMonth) break;
      }

      summary.innerHTML = `Kunlik harajat: ${dailyTotal.toLocaleString()} so'm<br>Oylik jami: ${monthlyTotal.toLocaleString()} so'm`;
    }

    window.save = (btn, key) => {
      let amount = btn.parentNode.parentNode.querySelector('input').value || 0;
      let note = btn.parentNode.parentNode.querySelector('textarea').value.trim();
      let data = JSON.parse(localStorage.getItem('expenses') || '{}');
      if (amount > 0 || note) {
        data[key] = {
          amount: amount,
          note: note,
          timestamp: new Date().toISOString()
        };
      } else {
        delete data[key];
      }
      localStorage.setItem('expenses', JSON.stringify(data));
      renderCalendar();
    };

    window.del = (btn, key) => {
      let data = JSON.parse(localStorage.getItem('expenses') || '{}');
      delete data[key];
      localStorage.setItem('expenses', JSON.stringify(data));
      renderCalendar();
    };

    prevYear.onclick = () => { year--; renderCalendar(); };
    nextYear.onclick = () => { year++; renderCalendar(); };
    prevMonth.onclick = () => { if (--month < 0) { month=11; year--; } renderCalendar(); };
    nextMonth.onclick = () => { if (++month > 11) { month=0; year++; } renderCalendar(); };

    function updateClock() {
      const n = new Date();
      let h = n.getHours();
      const m = n.getMinutes().toString().padStart(2,'0');
      const s = n.getSeconds().toString().padStart(2,'0');
      document.getElementById('time').textContent = (localStorage.getItem('is24')??'true')==='true'
        ? `${h.toString().padStart(2,'0')}:${m}:${s}`
        : `${(h%12||12)}:${m}:${s} ${h>=12?'PM':'AM'}`;
      document.getElementById('day').textContent = ["Yakshanba","Dushanba","Seshanba","Chorshanba","Payshanba","Juma","Shanba"][n.getDay()];
      document.getElementById('date').textContent = `${n.getDate()} ${months[n.getMonth()]}`;
      document.getElementById('year').textContent = `${n.getFullYear()} yil`;
    }

    document.getElementById('toggleBtn').onclick = () => {
      let v = localStorage.getItem('is24')??'true';
      localStorage.setItem('is24', v==='true'?'false':'true');
      updateClock();
    };

    renderCalendar();
    updateClock();
    setInterval(updateClock, 1000);
  </script>
</body>
</html>